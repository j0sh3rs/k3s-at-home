---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: KubeClarity
  namespace: auditors
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://openclarity.github.io/kubeclarity/
      chart: blocky
      version: 1.0.2
      sourceRef:
        kind: HelmRepository
        name: j0sh3rs-charts
        namespace: flux-system
      interval: 5m
  valuesFrom:
    - kind: Secret
      name: kubeclarity-secrets
      valuesKey: databasePassword
      targetPath: global.databasePassword
  values:
    kubeclarity:
      podAnnotations:
        reloader.stakater.com/auto: 'true'
    kubeclarity-runtime-scan:
      analyzer:
        analyzerList: 'syft gomod trivy'
        trivy:
          enabled: true
      scanner:
        scannerList: 'grype trivy dependency-track'
        dependency-track:
          enabled: true
        trivy:
          enabled: true
    kubeclarity-trivy-server:
      enabled: true
      image:
        tag: 0.36.1
    kubeclarity-postgresql:
      auth:
        existingSecret: kubeclarity-secrets
      image:
        tag: 15
