---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gitea
  namespace: services
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://dl.gitea.io/charts/
      chart: gitea
      sourceRef:
        kind: HelmRepository
        name: gitea-charts
        namespace: flux-system
      interval: 5m
  values:
    # containerSecurityContext:
    #   allowPrivilegeEscalation: false
    #   capabilities:
    #     drop:
    #       - ALL
    #   privileged: false
    #   readOnlyRootFilesystem: true
    #   runAsGroup: 1000
    #   runAsNonRoot: false
    #   runAsUser: 1000
    resources:
      limits:
        cpu: 1
        memory: 2Gi
      requests:
        cpu: 100m
        memory: 128Mi
    persistence:
      enabled: true
      size: 20Gi
      accessModes:
        - ReadWriteMany
      storageClass: longhorn
    signing:
      enabled: true
    gitea:
      admin:
        existingSecret: gitea-admin-secret
      metrics:
        enabled: true
        serviceMonitor:
          enabled: true
      additionalConfigSources:
        - secret:
            secretName: gitea-config-secrets
    postgresql:
      enabled: false
    memcached:
      enabled: false