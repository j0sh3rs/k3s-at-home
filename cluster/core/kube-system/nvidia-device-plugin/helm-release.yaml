---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: nvidia-device-plugin
  namespace: kube-system
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://nvidia.github.io/k8s-device-plugin
      chart: nvidia-device-plugin
      version: 0.12.2
      sourceRef:
        kind: HelmRepository
        name: nvidia
        namespace: flux-system
      interval: 5m
  install:
    createNamespace: true
  values:
    compatWithCPUManager: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        memory: 512Mi
        cpu: 4
    gfd:
      enabled: true
    nfd:
      config:
        core:
          sources:
            - custom
            - pci
            - usb
        sources:
          pci:
            deviceClassWhitelist:
            - "01"
            - "02"
            - "0200"
            - "0207"
            - "03"
            - "0400"
            deviceLabelFields:
            - vendor
          usb:
            deviceClassWhitelist:
              - "02"
              - "03"
              - "0e"
              - "ef"
              - "fe"
              - "ff"
            deviceLabelFields:
              - "class"
              - "vendor"
              - "device"